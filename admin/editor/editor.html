import { useEffect, useRef, useState } from "react";
import EditorJS from "@editorjs/editorjs";
import Header from "@editorjs/header";
import Table from "@editorjs/table";
import List from "@editorjs/list";

const EDITOR_HOLDER_ID = "editor";

const Editor = ({ data, setData }) => {
  const ejInstance = useRef(null);
  const [editorData, setEditorData] = useState(data);

  useEffect(() => {
    if (!ejInstance.current) {
      initEditor();
    }

    return () => {
      if (ejInstance.current) {
        ejInstance.current.destroy();
        ejInstance.current = null;
      }
    };
  }, []);

  useEffect(() => {
    setEditorData(data); // Ensure data updates when props change
  }, [data]);

  const initEditor = () => {
    const editor = new EditorJS({
      holder: EDITOR_HOLDER_ID,
      logLevel: "ERROR",
      data: editorData,
      onReady: () => {
        ejInstance.current = editor;
      },
      onChange: async () => {
        try {
          const outputData = await editor.save();
          setData((prevState) => ({
            ...prevState,
            blocks: outputData.blocks,
          }));
          setEditorData(outputData);
        } catch (error) {
          console.error("Saving failed:", error);
        }
      },
      autofocus: true,
      tools: {
        header: {
          class: Header,
          config: {
            placeholder: "Enter a header",
            levels: [1],
            defaultLevel: 1,
          },
        },
        table: {
          class: Table,
          inlineToolbar: true,
          config: {
            rows: 2,
            cols: 3,
          },
          data: {
            withHeadings: true,
          },
        },
        list: {
          class: List,
          inlineToolbar: true,
          config: {
            defaultStyle: "unordered",
          },
        },
      },
    });
  };

  return <div id={EDITOR_HOLDER_ID} className="py-2 bg-white rounded-md h-fit" />;
};

export default Editor;

